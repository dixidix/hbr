<div class="row">
    <form class="billing-info shopping__purchase" name="shopping.shoppingForm_purchase" data-ng-submit="shopping.shoppingForm_purchase.$valid && !shopping.shoppingForm_purchase.$pristine && shopping.shoppingForm_purchase.$submitted && shopping.add_bill()">
        <div class="col-xs-12 form-padding">
            <div class="row info">
                <div class="col-xs-10">
                    <span><i class="fa fa-info-circle"></i> Para completar este formulario debes tener en cuenta que una factura contiene varios productos. Entonces por cada factura que cargues, puedes cargar varios productos. Para saber mas, haz click en el signo de pregunta.</span>
                </div>
                <div class="help-container col-xs-1 col-xs-offset-1 no-padding">
                    <span class="pull-right" ng-class="shopping.helpOpened ? 'open':''" uib-tooltip="{{ttext}}" tooltip-placement="right">
                        <i  uib-popover-template="'billingHelpTemplate.html'" popover-class="help" ng-click="shopping.toggleHelp()" popover-placement="left" popover-trigger="click"
                        class="fa fa-2x" data-ng-class="shopping.helpOpened === true ? 'fa-times-circle-o':'fa-question-circle-o'"></i>
                    </a>
                    <script type="text/ng-template" id="billingHelpTemplate.html">
                        <div class="form-group">
                            <article>
                                <header>
                                    <h3>Ayuda:</h3>
                                </header>
                                <p>
                                    Todos los campos con un asterisco (<i class="fa fa-asterisk" aria-hidden="true"></i>) son requeridos para poder enviar el formulario. si el campo no posee el asterisco significa que es optativo, pero mientras m&aacute;s informaci&oacute;n aportes mejor ser&aacute; el servicio que te podr&eacute;mos proporcionar.
                                    <ul class="help-menu">
                                        <li class="menu-item">
                                            <p> <span class="badge">1</span> - Primero debes agregar
                    los datos de tu factura:
                    <ul>
                        <li>
                            <b><i class="fa fa-shopping-bag"></i> Tienda de compra:</b> Tienda en la que realizaste la compra.
                            Ej. "Amazon".
                        </li>
                        <li>
                            <b><i class="fa fa-file-text"></i> NÂ° de factura:</b> N&uacute;mero otorgado por la tienda en
                            la que realizaste la compra.
                        </li>
                        <li>
                            <b><i class="fa fa-truck"></i> Prestador Postal:</b> Nombre de la compan&iacute;a que llevar&aacute;
                            el producto hasta nuestros dep&oacute;sitos. Ej. "DHL".
                        </li>
                        <li>
                            <b><i class="fa fa-map"></i> N&uacute;mero de Tracking de la compra:</b> Num. otorgado por el
                            prestador postal para dar seguimiento del env&iacute;o.
                        </li>
                        <li>
                            <b><i class="fa fa-home"></i> Warehouse:</b> Aqu&iacute; debes escoger entre uno de nuestros
                            dep&oacute;sitos, aqu&iacute; llegar&aacute;n tus compras.
                        </li>
                        <li>
                            <b><i class="fa fa-file-pdf-o"></i> Factura (PDF):</b> Adjunta la factura que te emiti&oacute;
                            la tienda de compra. Esta factura debe estar en formato PDF.
                        </li>
                    </ul>
                    </li>

                    <li class="menu-item">
                        <p> <span class="badge">2</span> - Luego debes agregar el producto que compraste (puedes agregar un tipo
                            de producto a la vez, si bien puedes poner la cantidad que quieras del mismo producto):
                            <ul>
                                <li>
                                    <b> <i class="fa fa-book"></i> Categor&iacute;a del producto:</b> Tipo de producto que
                                    has comprado. Ej. "Indumentaria".
                                </li>
                                <li>
                                    <b><i class="fa fa-list-alt"></i> Producto:</b> Nombre del producto. Ej. "Remera Manga
                                    Larga talle xl".
                                </li>
                                <li>
                                    <b><i class="fa fa-shopping-cart"></i> Cantidad:</b>Cantidad de productos del mismo tipo
                                    y nombre que has comprado.
                                </li>
                                <li>
                                    <b>U<i class="fa fa-usd"></i>D Precio (x unidad):</b> precio de cada uno los de productos
                                    del mismo tipo y nombre que has comprado.
                                </li>
                                <li>
                                    <b><i class="fa fa-balance-scale"></i> Peso en KG:</b> Peso de cada uno los de productos
                                    del mismo tipo y nombre que has comprado. Si no conoces esta informaci&oacute;n nuestros
                                    dep&oacute;sitos lo pesar&aacute;n por t&iacute;.
                                </li>
                            </ul>
                    </li>
                    <li class="menu-item">
                        <p> <span class="badge">3</span> - <i class="fa fa-info-circle"></i> Una vez que termines de agregar
                            el producto presiona en el bot&oacute;n "Agregar Producto", este producto pasar&aacute; a formar
                            parte del detalle de la factura, representado por una tabla.</p>
                        <p>Una vez que estes listo para terminar de cargar la factura, presiona en el bot&oacute;n "Terminar
                            Factura". Ese bot&oacute;n guardar&aacute; la factura en un lote de compra que encontraras en
                            el paso n&uacute;mero 3 del proceso. Notar&aacute;s que el formulario de factura esta limpio
                            y listo para que agregues otra factura si as&iacute; lo deseas. </p>
                    </li>
                    </ul>
                    </p>
                    </article>
                </div>
                </script>
            </div>
        </div>
        <h3>Informaci&oacute;n de la Factura</h3>
        <!-- TIENDA DE COMPRA -->
        <div class="form-group col-xs-12 col-sm-4" data-ng-class="{'has-error': shopping.shoppingForm_purchase.name.$invalid && shopping.shoppingForm_purchase.$submitted}">
            <label class="control-label" for="establishment">Tienda de compra (*)</label><br>
            <div class="input-group">
                <span class="input-group-addon" id="basic-addon1"><i class="fa fa-shopping-bag"></i></span>
                <input id="establishment" class="form-control" type="text" name="establishment" ng-model="shopping.bill.establishment" placeholder="Tienda de compra"
                    autocomplete="off" required>
            </div>
        </div>

        <!-- NUMERO DE FACTURA -->
        <div class="form-group col-xs-12 col-sm-4" data-ng-class="{'has-error': shopping.shoppingForm_purchase.name.$invalid && shopping.shoppingForm_purchase.$submitted}">
            <label class="control-label" for="bill_number">N&uacute;mero de Factura (*)</label><br>
            <div class="input-group">
                <span class="input-group-addon" id="basic-addon1"><i class="fa fa-file-text"></i></span>
                <input id="bill_number" class="form-control" type="text" name="bill_number" ng-model="shopping.bill.number" placeholder="N&uacute;mero de factura"
                    autocomplete="off" required>
            </div>
        </div>

        <!-- PRESTADOR POSTAL -->
        <div class="form-group col-xs-12 col-sm-4" data-ng-class="{'has-error': shopping.shoppingForm_purchase.postal.$invalid && shopping.shoppingForm_purchase.$submitted}">
            <label class="control-label" for="postal">Prestador Postal (*)</label><br>
            <div class="input-group">
                <span class="input-group-addon" id="basic-addon1"><i class="fa fa-truck"></i></span>
                <input id="postal" class="form-control" type="text" name="postal" ng-model="shopping.bill.provider" placeholder="Nombre del prestador postal"
                    autocomplete="off" required>
            </div>
        </div>

        <!-- NUMERO DE TRACKING -->
        <div class="form-group col-xs-12 col-sm-4" data-ng-class="{'has-error': shopping.shoppingForm_purchase.name.$invalid && shopping.shoppingForm_purchase.$submitted}">
            <label class="control-label" for="tracking_number">N&uacute;mero de Tracking de la compra
                        (*)</label><br>
            <div class="input-group">
                <span class="input-group-addon" id="basic-addon1"><i class="fa fa-map"></i></span>
                <input id="tracking_number" class="form-control" type="text" name="tracking_number" ng-model="shopping.bill.tracking_number"
                    placeholder="N&uacute;mero de tracking" autocomplete="off" required>
            </div>
        </div>
        <!-- WAREHOUSE -->
        <div class="form-group col-xs-12 col-sm-4" data-ng-class="{'has-error': shopping.shoppingForm_purchase.name.$invalid && shopping.shoppingForm_purchase.$submitted}">
            <label class="control-label" for="warehouses">Warehouse
                        (*)</label><br>
            <div class="input-group">
                <span class="input-group-addon" id="basic-addon1"><i class="fa fa-home"></i></span>
                <select class="form-control" ng-options="warehouse.name for warehouse in shopping.warehouses track by warehouse.id" name="warehouses"
                    id="warehouses" ng-model="shopping.bill.whId">
                        <option value="" disabled="disabled">-- Selecciona un Warehouse --</option>
                        </select>
            </div>
        </div>
        <div class="form-group col-xs-12" data-ng-class="{'has-error': shopping.shoppingForm_purchase.bill_file.$invalid && shopping.shoppingForm_purchase.$submitted}">
            <label for="bill_file" class="control-label">Agregar Factura ( PDF ) (*)</label>
            <div class="input-group">
                <span class="input-group-addon" id="basic-addon1"><i class="fa fa-file-pdf-o"></i></span>
                <input type="file" name="bill_file" id="bill_file" required ng-model="shopping.bill.bill_file" uploader-model="shopping.bill.bill_file"
                />
            </div>
        </div>
</div>
<div class="col-xs-12">
    <p class="text-danger" ng-if="shopping.bill_error"><i class="fa fa-warning"></i> {{shopping.bill_error}}</p>
</div>
<br>
<div class="col-xs-12" id="bill-detail">
    <h3>Detalle de la Factura</h3>
    <h4>Agregar Productos</h4>
    <div class="form-group col-xs-12 col-sm-4" data-ng-class="{'has-error': shopping.shoppingForm_purchase.name.$invalid && shopping.shoppingForm_purchase.$submitted}">
        <label class="control-label" for="categories">Categor&iacute;a del producto (*)</label><br>
        <div class="input-group">
            <span class="input-group-addon" id="basic-addon1"><i class="fa fa-book"></i></span>
            <select class="form-control" ng-options="category.name for category in shopping.categories track by category.category_id"
                name="categories" id="categories" ng-model="shopping.aux_product.category" required>
                        <option value="" disabled="disabled">-- Selecciona Categor&iacute;a --</option>
                        </select>
        </div>
        <i class="fa fa-chevron-right" style="position: absolute;top: 40px; left: 310px;"></i>
    </div>


    <div class="form-group col-xs-12 col-sm-4" data-ng-class="{'has-error': shopping.shoppingForm_purchase.name.$invalid && shopping.shoppingForm_purchase.$submitted}">
        <label class="control-label" for="product_name">Producto (*)</label><br>
        <div class="input-group">
            <span class="input-group-addon" id="basic-addon1"><i class="fa fa-list-alt"></i></span>
            <input id="product_name" class="form-control" type="text" name="product_name" ng-model="shopping.aux_product.name" placeholder="Escribe el nombre del producto"
                autocomplete="off" required>
        </div>
    </div>


    <div class="form-group col-xs-12 col-sm-4" data-ng-class="{'has-error': shopping.shoppingForm_purchase.name.$invalid && shopping.shoppingForm_purchase.$submitted}">
        <label class="control-label" for="quantity">Cantidad (*)</label><br>
        <div class="input-group">
            <span class="input-group-addon" id="basic-addon1"><i class="fa fa-shopping-cart"></i></span>
            <input id="quantity" class="form-control" type="number" name="quantity" ng-model="shopping.aux_product.quantity" placeholder="Cantidad de productos"
                autocomplete="off" required>
        </div>
    </div>
</div>
<div class="col-xs-12 form-padding">
    <div class="form-group col-xs-12 col-sm-4" data-ng-class="{'has-error': shopping.shoppingForm_purchase.name.$invalid && shopping.shoppingForm_purchase.$submitted}">
        <label class="control-label" for="price">Precio (x unidad)(*)</label><br>
        <div class="input-group">
            <span class="input-group-addon" id="basic-addon1">U<i class="fa fa-usd"></i>D</span>
            <input id="price" class="form-control" type="number" step="0.01" name="name" ng-model="shopping.aux_product.price" placeholder="Precio del producto en d&oacute;lares"
                autocomplete="off" required>
        </div>
    </div>

    <div class="form-group col-xs-12 col-sm-4" data-ng-class="{'has-error': shopping.shoppingForm_purchase.name.$invalid && shopping.shoppingForm_purchase.$submitted}">
        <label class="control-label" for="weight">Peso en KG. (x unidad)</label><br>
        <div class="input-group">
            <span class="input-group-addon" id="basic-addon1"><i class="fa fa-balance-scale"></i></span>
            <input id="weight" class="form-control" type="number" step="0.01" name="weight" ng-model="shopping.aux_product.weight" placeholder="Peso del producto"
                autocomplete="off">
        </div>
    </div>
    <div class="col-xs-12 col-sm-12 no-padding">
        <div class="form-group col-xs-12 col-sm-3" data-ng-class="{'has-error': shopping.shoppingForm_purchase.name.$invalid && shopping.shoppingForm_purchase.$submitted}">
            <button type="button" ng-click="shopping.add_product()" ng-disabled="!shopping.aux_product.name || !shopping.aux_product.category || !shopping.aux_product.quantity || !shopping.aux_product.price"
                class="btn btn-hbr-green" ng-if="!editProduct"><i class="fa fa-plus"></i> Agregar Producto</button>
            <button type="button" ng-click="shopping.edit_product()" ng-disabled="!shopping.aux_product.name || !shopping.aux_product.category || !shopping.aux_product.quantity || !shopping.aux_product.price"
                class="btn btn-hbr-green" ng-if="editProduct"><i class="fa fa-save"></i> Editar Producto</button>
        </div>
    </div>
    <div class="col-xs-12">
        <p class="text-danger" ng-if="shopping.product_error"><i class="fa fa-warning"></i> {{shopping.product_error}}</p>
    </div>
    <div class="col-xs-12 product-table" ng-if="shopping.bill.products.length">
        <h4>Vista previa de la factura</h4>
        <table class="col-xs-12 table table-bordered table-striped table-curved rounded">
            <thead>
                <tr>
                    <td class="col-xs-12" colspan="5"><span>Factura</span></td>
                </tr>
                <tr>
                    <td><span>Tienda</span></td>
                    <td><span>NÂ° Factura</span></td>
                    <td><span>Prestador Postal</span></td>
                    <td><span>NÂ° Tracking</span></td>
                    <td><span>Warehouse</span></td>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td style="border-bottom:0;"><span> {{shopping.bill.establishment}} </span></td>
                    <td style="border-bottom:0;"><span> {{shopping.bill.number}} </span></td>
                    <td style="border-bottom:0;"><span> {{shopping.bill.provider}} </span></td>
                    <td style="border-bottom:0;"><span> {{shopping.bill.tracking_number}}</span></td>
                    <td style="border-bottom:0;"><span> {{shopping.bill.whId.name }} </span></td>
                </tr>
            </tbody>
        </table>
        <table class="table table-bordered table-striped table-curved rounded">
            <thead>
                <tr>
                    <td class="col-xs-12" colspan="9"><span>Detalle</span></td>
                </tr>
                <tr>
                    <td><span>Categor&iacute;a</span></td>
                    <td><span>Producto</span></td>
                    <td><span>Cantidad</span></td>
                    <td><span>Peso</span></td>
                    <td><span>Precio</span></td>
                    <td><span>Peso Total</span></td>
                    <td><span>Precio Total</span></td>
                    <td><span>Eliminar Prod.</span></td>
                </tr>
            </thead>
            <tbody>
                <tr ng-repeat="product in shopping.bill.products track by $index">
                    <td><span> {{product.category.name}} </span></td>
                    <td><span> {{product.name}} </span></td>
                    <td><span> {{product.quantity}} </span></td>
                    <td><span> {{product.weight}} KG.</span></td>
                    <td><span> {{product.price | currency }} </span></td>
                    <td><span> {{product.total_weight }} KG.</span></td>
                    <td><span> {{product.total_price | currency }} </span></td>
                    <td><span style="color:red; cursor:pointer;"><i class="fa fa-close" ng-click="shopping.removeProduct(product, $index)"></i></span></td>
                </tr>
            </tbody>
        </table>
        <div class="col-xs-12 no-padding">
            <h5 class="total-factura">Total: {{ shopping.bill.total_price | currency }}</h5>
        </div>
    </div>
</div>
<div class="col-xs-12">
    <button ng-disabled="!shopping.lote.bills.length" id="billing-next-step" class="btn pull-right btn-hbr-steps" ng-click="shopping.nextStep($index)">Siguiente Paso <i class="fa fa-chevron-right"></i></button>
    <button type="button" ng-click="shopping.add_bill()" ng-disabled="!shopping.bill.products.length" class="btn pull-right btn-hbr-steps"
        ng-if="!editBill">Guardar Factura</button>
    <button type="button" ng-click="shopping.edit_bill()" ng-disabled="!shopping.bill.products.length" class="btn pull-right btn-hbr-steps"
        ng-if="editBill">Editar Factura</button>
</div>
<div class="col-xs-12">
    <div ng-if="shopping.lote.bills.length">
        <p><i class="fa fa-info-circle"></i> Cant. Facturas en el lote: {{shopping.lote.bills.length}} - Total Lote: {{shopping.lote.total_price}}
            U$D - Total peso Lote: {{shopping.lote.total_weight}} KG. </p>
        <p>Puedes Seguir Agregando facturas (arriba <i class="fa fa-arrow-up"></i>) o ir al siguiente paso.</p>
    </div>
    <span ng-if="!shopping.bill.products.length && !shopping.lote.bills.length"><i class="fa fa-info-circle"></i> Para pasar al siguiente paso, debes agregar una factura y al menos un producto a la misma.</span>
    <span ng-if="!shopping.lote.bills.length && shopping.bill.products.length"><i class="fa fa-info-circle"></i> Para pasar al siguiente paso, debes guardar la factura, o puedes seguir agregando productos a la misma.</span>
</div>
</form>
</div>